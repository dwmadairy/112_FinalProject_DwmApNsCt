---
title: "The Himalayas: Understanding Summit Success"
author: "Charlie Thole, Natali Sorajja, Andrew Polk, Will Madairy"
date: "12/17/2019"
output:
  html_document:
    css: style.css
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE, echo=FALSE}
library(shiny)
library(foreign)
library(tidyverse)
library(ggplot2)
library(readr)
library(leaflet)
library(knitr)
```

```{r, message=FALSE, warning=FALSE, echo=FALSE}
climberpeak <- read_csv("climberpeakV2.csv")
```

## **Introduction**
In our project, we analyzed a robust dataset of Himalayan mountain expeditions. We were inspired to explore this field after reading numerous news articles about several factors making these expeditions more dangerous. Sherpa strikes, overcrowding on peaks, and especially climate change make these already harrowing journeys even more treacherous. Our data allows us to explore expeditions on hundreds of peaks from 1905 through 2018, so our goal in this blogpost is to attempt to align the recent research with concrete data analysis.
  
## **Research Questions**
Are recent factors like sherpa strikes, overcrowding, and climate change discouraging climbers from summiting Himalayan peaks? Do these recent factors lead to more injuries or deaths?
	
## **Data Collection/Description**
We utilized two datasets from “The Himalayan Database” in this project. Elizabeth Hawley began compiling an expedition archive for the Nepal Himalayan peaks in 1963, and this data set now contains over 450 peaks and over 10,000 expeditions. The main dataset we used contained these 10,000 expeditions, with several dozen variables to describe the expedition. We joined this dataset with another dataset that contained the names of the peaks the climbers’ explored, and we joined them through the common variable “Peak ID”. 
  
## **Climbing Over Time**
First, it is important to show the amount of expeditions per year and which peaks are the most popular to climb within the dataset. Has climbing becoming more popular? Has reaching the peak become easier?

```{r, echo = FALSE, warning = FALSE, message = FALSE}
climberpeakV2 <- read_csv("climberpeakV2.csv")

```

```{r, echo = FALSE}
climberpeakV2 %>%
  group_by(YEAR) %>%
  mutate(expeds = sum(n())) %>%
  ggplot(aes(x=YEAR, y = expeds)) + geom_line() + 
  xlab("Year") + 
  ylab("Expeditions") + 
  ggtitle("Expeditions per Year") 
```


```{r, echo = FALSE}
climberpeakV2 %>%
  group_by(YEAR) %>%
  filter(YEAR > 1970) %>%
  mutate(Expeditions = sum(n())) %>%
  mutate(avg_complete = (mean(pctcomplete)*100)) %>%
  ggplot(aes(x = YEAR, y = avg_complete)) + 
  geom_point(aes(size = Expeditions)) + 
  geom_line() +
  ggtitle("Average Percent Complete Expeditions by Year") + 
  xlab("Year") +
  ylab("Average Percent Complete")
```


The harsh drop in average percentage completion of expeditions in 2014 was due to first a large avalanche and then a Sherpa strike. As you can see from the size of the dot, a large amount of people still attempted expeditions during this year, but without the help of Sherpas, they were unable to complete as many expeditions as normal. 

## **Who Climbs and Where From?**
Another key introduction to the data is exploring where the climbers were from and how high each of them climbed over time.
Altogether, people from 91 different nations have attempted to climb at least one of these peaks, according to this dataset. We made a visualization of how high each of these people climbed based on their country of origin.

```{r, echo=FALSE}
nation <-
  unique(climberpeak$NATION) %>% 
  str_split(pattern = '/') %>% 
  unlist() %>% 
  unique() %>% 
  str_sort()
```

```{r, echo=FALSE}
inputPanel(
  selectInput("nations", "Nation of Origin", nation)
  )

renderPlot({
    ggplot() +
    geom_point(aes(YEAR, HIGHPOINT, color = SUCCESS1), data = climberpeak %>% 
    filter(NATION == input$nations)) +
    geom_smooth(aes(YEAR, HIGHPOINT, color = SUCCESS1), data = climberpeak %>%
    filter(NATION == input$nations), se = FALSE) +
    labs(title = "Distance Climbed by Nation", x = "Year", y = "Distance Climbed (m)")
  })
```


```{r, warning = FALSE, message = FALSE, echo=FALSE}
top_10_nations <-climberpeakV2 %>%
  filter(YEAR >1980) %>%
  group_by(NATION) %>% 
  summarize(Expeditions=sum(n())) %>% 
  #arrange(desc(expeds)) %>%
  top_n(10) %>%
  arrange(desc(expeds))

kable(top_10_nations)
```



To reiterate, this dataset includes more than 450 peaks, even though some of them have only been attempted a few times. So, we found the top ten most popular peaks and used a Leaflet map to visualize the number of expeditions on these peaks as well as their summit success rate.

```{r, echo=FALSE}
peakcoords <- tibble(PKNAME = c("Everest", "Ama Dablam", "Cho Oyu", "Manaslu", "Lhotse", "Dhaulagiri I", "Makalu", "Baruntse", "Pumori", "Annapurna I"), long = c(86.925, 86.8612, 86.6585, 84.5597, 86.9336, 83.4873, 87.0912, 86.979649, 86.8253, 83.8203), lat = c(27.9881, 27.8619, 28.0973, 28.5497, 27.9626, 28.6985, 27.886, 27.872062, 28.009, 28.5961), peakheight = c(8850, 6814, 8188, 8163, 8516, 8167, 8485, 7152, 7138, 8091), expeds = c(2059, 1353, 1329, 632, 406, 381, 346, 307, 263, 240), success_rate = c("59.8%", "67.9%", "61.7%", "48.9%", "55.9%", "40.7%", "39.6%", "38.1%", "45.6%", "31.3%"))
```

**Most Popular Peaks**
*By Number of Expeditions; Label shows Peak Height (meters) and Summit Success Rate*
```{r, echo=FALSE}
leaflet(data = peakcoords) %>% 
  addProviderTiles(providers$Stamen.Terrain) %>% 
  addCircles(lng = ~long, lat = ~lat, popup = ~paste(PKNAME, " :", peakheight, "Meters, ", expeds, "Expeditions, ", success_rate, "Success Rate"), weight = 20) 
  
```

As shown in the Leaflet, some of the most popular peaks have low success rate, like Annapurna I, where only 1/3 of climbers reach the summit. Why do these climbers fail?

## **Reasons for Failure on the Mountains**

```{r warning = FALSE, message = FALSE, echo=FALSE}
rsns = c(4, 5, 6 ,7, 8, 9)
rsns_legend=c("Weather",  "Avalanche or Snow Fall", "Fatality", "Illness or Injury", "Lack of Supplies", "Lack of Time")

climberpeak %>% 
  group_by(YEAR, TERMREASON) %>% 
  filter(TERMREASON %in% rsns) %>% 
  summarize(expeds = sum(n())) %>% 
  ggplot(aes(x=YEAR, y=expeds, fill=factor(TERMREASON)))+
  geom_area(aes(fill=factor(TERMREASON)))+
  xlim(c(1975, 2018))+
  scale_fill_discrete(name="Termination Reason", breaks=rsns, labels=rsns_legend)+
  labs(x="Year",y="Expeditions")
  
```

In this plot as expected we see that more expeditions are failing within the Himalayas, as we would expect as more and more expeditions are attempted. 

In this plot we have a stacked plot that shows the general reasons why expeditions fail overtime. In recent years there has been a general rise in weather related issues on the mountain as well as increases in avalanches. We also see that fatalities remains relatively flat over time, but there is an increase in the number of expeditions that fail due to illness or injury.



```{r echo=FALSE}
toppeaks<-climberpeak %>% 
  group_by(PKNAME) %>% 
  summarize(expeds = sum(n())) %>% 
  arrange(desc(expeds)) %>% 
  select(PKNAME) %>% 
  head(n=15)
```

```{r echo=FALSE}
inputPanel(
  selectInput("Mountain", "Mountain of Interest", toppeaks)
)
rsns = c(4, 5, 6 ,7, 8, 9)
rsns_legend=c("Weather",  "Avalanche or Snow Fall", "Fatality", "Illness or Injury", "Lack of Supplies", "Lack of Time")

renderPlot({
  climberpeak %>% 
    filter(PKNAME == input$Mountain) %>% 
    filter(TERMREASON %in% rsns) %>% 
    group_by(YEAR, TERMREASON) %>% 
    summarize(expeds_term_year = sum(n())) %>% 
    group_by(YEAR) %>% 
    mutate(yearprop=expeds_term_year/sum(expeds_term_year)) %>% 
    ggplot(aes(x=YEAR, yearprop))+
    geom_line(position="stack", show.legend=FALSE)+
    geom_area(aes(fill=factor(TERMREASON)))+
    xlim(c(1975, 2018))+
    scale_fill_discrete(name="Termination Reason", breaks=rsns, labels=rsns_legend)+
    labs(x="Year", y="Proportion of Failures")
  })
```


## **Conclusion**
	
After our analysis of the data, we find it very important to note that each observation in our dataset is a human being. Many of these “observations” sustained injuries or even died on the Himalayan peaks. We hoped that this project investigated why these peaks have become more dangerous, and may serve to guide and warn future climbers. 

Our main conclusions include:
- Total expeditions declined drastically in 2014 due to sherpa strikes, and the number has not fully recovered in recent years
- Our data includes climbers from dozens of nations, with United States, Japan, and the U.K. representing the most climbers in the dataset, showing climbers come from all around the world to attempt a summit of the Himalayans
- Specific peaks, like Cho Oyu and Lhotse, have experienced decreases in total expeditions, which aligns with research about foot traffic and prices of climbing
- Weather as a termination reason has increased over time, but on Everest, weather-related termination has slowed while injury and avalanche-related injuries have increased.


